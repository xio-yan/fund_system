{% extends "layout.html" %}
{% block content %}
<div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 max-w-3xl mx-auto">
  <h2 class="text-xl font-semibold mb-4">編輯核銷（退回）</h2>

  <form method="post" enctype="multipart/form-data"onsubmit="return confirm('確定要重新送出核銷嗎？\n此動作將覆蓋原有資料並重新進入審核。');" class="space-y-4">
    <div>
      <label class="block text-sm font-medium mb-1">檢討事項／補充說明</label>
      <textarea name="comment" rows="4" class="w-full border p-2 rounded-lg">{{ r.comment }}</textarea>
    </div>

    <h3 class="text-lg font-semibold mt-4 mb-2">收據明細</h3>
    <div id="receipt-list">
      {% for it in items %}
      <div class="flex gap-2 mb-2">
        <input type="text" name="rec_name[]" value="{{ it.item_name }}" placeholder="款項" class="flex-1 border p-2 rounded-lg">
        <input type="text" name="rec_purpose[]" value="{{ it.purpose }}" placeholder="用途" class="flex-1 border p-2 rounded-lg">
        <input type="number" step="0.01" name="rec_amount[]" value="{{ it.amount }}" placeholder="金額" class="w-32 border p-2 rounded-lg">
        <input type="file" name="rec_receipt[]" class="w-40 border rounded-lg">
      </div>
      {% endfor %}
      <button type="button" onclick="addRow()" class="text-sm text-blue-600 hover:underline">＋新增一筆</button>
    </div>

    <h3 class="text-lg font-semibold mt-4 mb-2">活動照片（至少 2 張）</h3>
    <input type="file" name="activity_photos[]" multiple class="w-full border p-2 mb-3 rounded">

    <h3 class="text-lg font-semibold mb-2">回饋單（至少 1 張）</h3>
    <input type="file" name="feedback_photo" class="w-full border p-2 mb-3 rounded">

    <div class="mt-6 text-right">
      <button type="submit" class="bg-emerald-600 hover:bg-emerald-700 text-white px-6 py-2 rounded-xl">
        重新送出核銷
      </button>
    </div>
  </form>
</div>

<script>
function addRow(){
  const list=document.getElementById('receipt-list');
  const div=document.createElement('div');
  div.className='flex gap-2 mb-2';
  div.innerHTML=`
    <input type="text" name="rec_name[]" placeholder="款項" class="flex-1 border p-2 rounded-lg">
    <input type="text" name="rec_purpose[]" placeholder="用途" class="flex-1 border p-2 rounded-lg">
    <input type="number" step="0.01" name="rec_amount[]" placeholder="金額" class="w-32 border p-2 rounded-lg">
    <input type="file" name="rec_receipt[]" class="w-40 border rounded-lg">
  `;
  list.insertBefore(div, list.lastElementChild);
}
</script>
{% endblock %}