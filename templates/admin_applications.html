{% extends "layout.html" %}
{% block content %}
<section class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6">
  <h2 class="text-xl font-semibold mb-4">所有申請紀錄（管理員）</h2>

  {% if apps|length == 0 %}
  <p class="text-slate-500">目前沒有申請紀錄。</p>
  {% else %}
  <div class="overflow-x-auto">
    <table class="w-full text-sm">
      <thead>
        <tr class="text-left text-slate-500">
          <th class="py-2">編號</th>
          <th>標題</th>
          <th>申請人</th>
          <th>單位</th>
          <th>總金額</th>
          <th>申請狀態</th>
          <th>核銷狀態</th>
          <th>操作</th>
        </tr>
      </thead>
      <tbody>
        {% for a in apps %}
        <tr class="border-t hover:bg-slate-50">
          <td class="py-2">{{ a.form_number or '-' }}</td>
          <td>{{ a.title or '(無標題)' }}</td>
          <td>{{ a.applicant_name or '-' }}</td>
          <td>{{ a.org_name or '-' }}</td>
          <td>{{ a.total_amount or '0' }}</td>
          <td>
            <span class="px-2 py-1 rounded-md text-xs
              {% if a.app_status == 'completed' %} bg-emerald-50 text-emerald-700 border border-emerald-200
              {% elif a.app_status == 'rejected' %} bg-rose-50 text-rose-700 border border-rose-200
              {% elif a.app_status in ['submitted', 'in_progress'] %} bg-sky-50 text-sky-700 border border-sky-200
              {% else %} bg-slate-50 text-slate-700 border border-slate-200 {% endif %}
            ">
              {{ status_label(a.app_status) }}
            </span>
          </td>
          <td>
            {% if a.reimburse_status %}
              <span class="px-2 py-1 rounded-md text-xs
                {% if a.reimburse_status == 'completed' %} bg-emerald-50 text-emerald-700 border border-emerald-200
                {% elif a.reimburse_status == 'rejected' %} bg-rose-50 text-rose-700 border border-rose-200
                {% else %} bg-sky-50 text-sky-700 border border-sky-200 {% endif %}
              ">
                {{ status_label(a.reimburse_status) }}
              </span>
            {% else %}
              <span class="text-slate-400">尚未核銷</span>
            {% endif %}
          </td>
          <td>
            <a href="{{ url_for('view_application', aid=a.id) }}" class="text-blue-600 hover:underline">查看</a>
            {% if a.reimburse_id %}
              <a href="{{ url_for('reimburse_view', rid=a.reimburse_id) }}" class="ml-2 text-indigo-600 hover:underline">核銷</a>
            {% endif %}
            <form method="post" action="{{ url_for('admin_delete_application', aid=a.id) }}" 
                  style="display:inline" 
                  onsubmit="return confirm('確定要刪除此申請與核銷紀錄？');">
              <button class="ml-2 text-rose-600 hover:underline">刪除</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% endif %}
</section>
{% endblock %}
