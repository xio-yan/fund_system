{% extends "layout.html" %}
{% block content %}
<div class="grid gap-6">
  <!-- ğŸ§ ä½¿ç”¨è€…ç®¡ç†å€å¡Š -->
  <section class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-xl font-semibold">ä½¿ç”¨è€…ç®¡ç†</h2>
      <a href="{{ url_for('admin_register') }}" class="bg-primary hover:bg-secondary text-white px-4 py-2 rounded-xl inline-flex items-center gap-2">
        <i data-feather="user-plus"></i> æ–°å¢ä½¿ç”¨è€…
      </a>
    </div>

    <div class="overflow-x-auto">
      <table class="w-full text-sm">
        <thead>
          <tr class="text-left text-slate-500">
            <th class="py-2">ID</th>
            <th>å¸³è™Ÿ</th>
            <th>å§“å</th>
            <th>è§’è‰²</th>
            <th>æ‰€å±¬å–®ä½</th>
            <th>è² è²¬æ•™å¸«</th>
            <th>æ“ä½œ</th>
          </tr>
        </thead>
        <tbody>
        {% for urec in users %}
          <tr class="border-t">
            <td class="py-2">{{ urec.id }}</td>
            <td>{{ urec.username }}</td>
            <td>{{ urec.display_name }}</td>
            <td>{{ role_label(urec.role) }}</td>
            <td>{{ urec.org_id or '-' }}</td>
            <td>
              {% set tname='-' %}
              {% for a in assigns %}
                {% if a.org_id==urec.org_id %}
                  {% set tname=a.teacher %}
                {% endif %}
              {% endfor %}
              {{ tname }}
            </td>
            <td class="space-x-3">
              <a href="{{ url_for('admin_edit_user', uid=urec.id) }}" class="text-blue-600 hover:underline">ç·¨è¼¯</a>
              {% if urec.role != 'admin' %}
              <form method="post" action="{{ url_for('admin_delete_user', uid=urec.id) }}" style="display:inline;" onsubmit="return confirm('ç¢ºå®šè¦åˆªé™¤ä½¿ç”¨è€… {{ urec.display_name }} å—ï¼Ÿæ­¤å‹•ä½œç„¡æ³•å¾©åŸ');">
                <button type="submit" class="text-rose-600 hover:underline">åˆªé™¤</button>
              </form>
              {% else %}
                <span class="text-slate-400">ï¼ˆä¿ç•™ï¼‰</span>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </section>

  <!-- ğŸ« å–®ä½ç®¡ç† -->
  <section class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6">
    <h2 class="text-xl font-semibold mb-4">ç³»æœƒç¤¾åœ˜å–®ä½ç®¡ç†</h2>
    <form method="post" action="{{ url_for('admin_add_org') }}" class="flex gap-2 mb-4">
      <input name="name" class="border border-slate-200 p-3 rounded-xl flex-1" placeholder="æ–°å¢å–®ä½åç¨±ï¼ˆä¾‹å¦‚ï¼šç³»æœƒCï¼‰" required>
      <button class="bg-primary hover:bg-secondary text-white px-4 py-2 rounded-xl">æ–°å¢å–®ä½</button>
    </form>

    <div class="overflow-x-auto">
      <table class="w-full text-sm">
        <thead><tr class="text-left text-slate-500"><th class="py-2">ID</th><th>åç¨±</th><th>æ“ä½œ</th></tr></thead>
        <tbody>
        {% for o in orgs %}
          <tr class="border-t">
            <td class="py-2">{{ o.id }}</td>
            <td>{{ o.name }}</td>
            <td>
              {% if o.name != 'å­¸ç”Ÿæœƒ' %}
              <form method="post" action="{{ url_for('admin_delete_org', oid=o.id) }}" onsubmit="return confirm('ç¢ºå®šåˆªé™¤æ­¤å–®ä½ï¼Ÿ');" style="display:inline">
                <button class="text-rose-600 hover:underline">åˆªé™¤</button>
              </form>
              {% else %}
                <span class="text-slate-400">ï¼ˆä¿ç•™ç³»çµ±å–®ä½ï¼‰</span>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>

    <h2 class="text-xl font-semibold my-4">è€å¸«åˆ†é…</h2>
    <form method="post" action="{{ url_for('admin_assign_teacher') }}" class="grid md:grid-cols-3 gap-2 mb-3">
      <select name="teacher_id" class="border border-slate-200 p-3 rounded-xl">
        {% for t in users if t.role=='org_teacher' %}
          <option value="{{ t.id }}">{{ t.display_name }} ({{ t.username }})</option>
        {% endfor %}
      </select>
      <select name="org_id" class="border border-slate-200 p-3 rounded-xl">
        {% for o in orgs if o.name!='å­¸ç”Ÿæœƒ' %}
          <option value="{{ o.id }}">{{ o.name }}</option>
        {% endfor %}
      </select>
      <button class="bg-primary hover:bg-secondary text-white px-4 py-2 rounded-xl">åˆ†é…</button>
    </form>
  </section>
</div>
{% endblock %}
