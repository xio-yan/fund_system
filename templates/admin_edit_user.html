{% extends "layout.html" %}
{% block content %}
<div class="max-w-xl bg-white rounded-2xl shadow-sm border border-slate-200 p-6 mx-auto">
  <h2 class="text-xl font-semibold mb-4">編輯使用者 - {{ u.username }}</h2>
  <form method="post" class="space-y-3">
    <div><label class="block text-sm text-slate-600 mb-1">帳號</label><input name="username" class="w-full border border-slate-200 p-3 rounded-xl" value="{{ u.username }}" required></div>
    <div><label class="block text-sm text-slate-600 mb-1">顯示名稱</label><input name="display_name" class="w-full border border-slate-200 p-3 rounded-xl" value="{{ u.display_name }}"></div>
    <div>
      <label class="block text-sm text-slate-600 mb-1">角色</label>
      <select name="role" class="w-full border border-slate-200 p-3 rounded-xl" id="role-select">
        {% for v,l in roles %}<option value="{{ v }}" {% if u.role==v %}selected{% endif %}>{{ l }}</option>{% endfor %}
      </select>
    </div>
    <div id="org-picker" class="{% if u.role!='org' %}hidden{% endif %}">
      <label class="block text-sm text-slate-600 mb-1">所屬系會（限 role=org）</label>
      <select name="org_id" class="w-full border border-slate-200 p-3 rounded-xl">
        <option value="">-- 請選擇 --</option>
        {% for o in orgs %}{% if o.name!='學生會' %}<option value="{{ o.id }}" {% if u.org_id==o.id %}selected{% endif %}>{{ o.name }}</option>{% endif %}{% endfor %}
      </select>
    </div>
    
    <div id="teacher-picker" class="{% if u.role!='org' %}hidden{% endif %}">
      <label class="block text-sm text-slate-600 mb-1">指派教師（僅 role=org）</label>
      <select name="assigned_teacher_id" class="w-full border border-slate-200 p-3 rounded-xl">
  <option value="">-- 不變更 / 不指派 --</option>
  {% for t in teachers %}
    <option value="{{ t.id }}" {% if current_teacher and current_teacher==t.id %}selected{% endif %}>{{ t.display_name }} ({{ t.username }})</option>
  {% endfor %}
</select>
      <p class="text-xs text-slate-500 mt-1">儲存後將以此教師負責此社團單位（若「所屬系會」一併修改，將以新單位為準）。</p>
    </div>

    <div><label class="block text-sm text-slate-600 mb-1">新密碼（留空不變）</label><input name="password" class="w-full border border-slate-200 p-3 rounded-xl"></div>
    <button class="bg-primary hover:bg-secondary text-white px-4 py-2 rounded-xl">儲存</button>
  
<div class="mt-3">
  <label class="block text-sm text-slate-600 mb-1">Email</label>
  <input type="email" name="email" value="{{ u.email or '' }}" placeholder="user@example.com" class="w-full border border-slate-200 p-2 rounded-xl">
</div>
</form>

</div>
<script>
const sel = document.getElementById('role-select');
const picker = document.getElementById('org-picker');
function togglePicker(){ if(sel.value==='org'){ picker.classList.remove('hidden'); document.getElementById('teacher-picker').classList.remove('hidden'); } else { picker.classList.add('hidden'); document.getElementById('teacher-picker').classList.add('hidden'); } }
sel.addEventListener('change', togglePicker);
</script>
{% endblock %}